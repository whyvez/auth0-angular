!function(){function a(a,b,c,d,e,f){this.auth0Lib=a,this.$cookies=b,this.$rootScope=c,this.$safeApply=d,this.$q=e,this.urlBase64Decode=f,this.delegatedTokens={}}var b=angular.module("util",[]);b.factory("$safeApply",["$rootScope","$exceptionHandler",function(a,b){return function(c,d){if(c=c||a,-1===["$apply","$digest"].indexOf(c.$root.$$phase))return c.$apply(d);try{return c.$eval(d)}catch(e){b(e)}}}]),b.value("urlBase64Decode",function(a){var b=a.replace("-","+").replace("_","/");switch(b.length%4){case 0:break;case 2:b+="==";break;case 3:b+="=";break;default:throw"Illegal base64url string!"}return window.atob(b)});var c=angular.module("auth0-auth",["util","ngCookies"]),d={forbidden:"auth:FORBIDDEN",loginSuccess:"auth:LOGIN_SUCCESS",loginFailed:"auth:LOGIN_FAILED",logout:"auth:LOGOUT",redirectEnded:"auth:REDIRECT_ENDED"};c.constant("AUTH_EVENTS",d),a.prototype={},a.prototype.parseHash=function(a,b){this.auth0Lib.parseHash(a,b)},a.prototype._deserialize=function(){return this.$cookies.profile?(this.profile=JSON.parse(this.$cookies.profile),this.isAuthenticated=!!this.profile,this.idToken=this.$cookies.idToken,void(this.accessToken=this.$cookies.accessToken)):(this.isAuthenticated=!1,this.profile=void 0,this.idToken=void 0,void(this.accessToken=void 0))},a.prototype._serialize=function(a,b,c){this.$cookies.profile=JSON.stringify(a),this.$cookies.idToken=b,this.$cookies.accessToken=c},a.prototype.hasTokenExpired=function(a){if(!a)return!0;var b=a.split(".");if(3!==b.length)return!0;var c=this.urlBase64Decode(b[1]);if(!c)return!0;try{c=JSON.parse(c)}catch(d){return!0}if(!c.exp)return!0;var e=new Date(0);return e.setUTCSeconds(c.exp),isNaN(e)?!0:e.valueOf()>(new Date).valueOf()?!1:!0},a.prototype.getToken=function(a,b,c){b=b||{scope:"openid"};var d=this,e=d.$q.defer();c&&(this.delegatedTokens[a]=void 0);var f=this.delegatedTokens[a],g=this.hasTokenExpired(f);if(f&&!g)return e.resolve(f),e.promise;var h=this.auth0Lib;return h.getDelegationToken||(h=h.getClient()),h.getDelegationToken(a,this.idToken,b,this._wrapCallback(function(b,c){return b?e.reject(b):(d.delegatedTokens[a]=c.id_token,e.resolve(c.id_token))})),e.promise},a.prototype.signin=function(a){a=a||{};var b=function(a,b,e,f,g){return a?void c.$rootScope.$broadcast(d.loginFailed,b):(c._serialize(b,e,f,g),c._deserialize(),c.$rootScope.$broadcast(d.loginSuccess,b),void c.$rootScope.$apply())},c=this;"undefined"!=typeof Auth0Widget&&c.auth0Lib instanceof Auth0Widget&&(b=null),c.auth0Lib.signin(a,b)},a.prototype.signout=function(){this._serialize(void 0,void 0,void 0),this._deserialize(),this.$rootScope.$broadcast(d.logout)},a.prototype._wrapCallback=function(a){var b=this;return function(){return b.$safeApply(void 0,a.apply(null,arguments))}},a.prototype.parseHash=function(a){return this.auth0Lib.parseHash(a)},a.prototype.getProfile=function(a){var b=this.$q.defer(),c=this._wrapCallback(function(a,c){return a?b.reject(a):void b.resolve(c)});return this.auth0Lib.getProfile(a,c),b.promise},a.prototype.signup=function(a){this.auth0Lib.signup(a)},a.prototype.reset=function(a){this.auth0Lib.reset(a)},c.provider("auth",["$provide",function(b){var c;this.init=function(a){var c;if(void 0===a.callbackOnLocationHash&&(a.callbackOnLocationHash=!0),"undefined"!=typeof Auth0Widget)c=new Auth0Widget(a);else{if("undefined"==typeof Auth0)throw new Error("You need to add Auth0Widget or Auth0.js dependency");c=new Auth0(a)}b.value("auth0Lib",c)},this.$get=["$cookies","$rootScope","$safeApply","$q","$injector","urlBase64Decode",function(b,d,e,f,g,h){var i=g.get("auth0Lib");if(!i)throw new Error("You need to add Auth0Widget or Auth0.js dependency");return c||(c=new a(i,b,d,e,f,h)),c}]}]),c.factory("parseHash",["auth","$rootScope","$window",function(a,b,c){return function(){var e=a.parseHash(c.location.hash);e&&e.id_token?a.getProfile(e.id_token).then(function(c){a._serialize(c,e.id_token,e.access_token,e.state),a._deserialize(),b.$broadcast(d.loginSuccess,c)},function(c){a._deserialize(),b.$broadcast(d.loginFailed,c)}):(a._deserialize(),b.$broadcast(d.redirectEnded))}}]);var e=angular.module("auth0",["auth0-auth"]);e.run(["parseHash",function(a){a()}]);var f=angular.module("authInterceptor",["auth0-auth"]);f.factory("authInterceptor",["auth","$rootScope","$q","AUTH_EVENTS",function(a,b,c,d){return{request:function(b){return b.headers=b.headers||{},a.idToken&&(b.headers.Authorization="Bearer "+a.idToken),b},responseError:function(a){return 401===a.status&&b.$broadcast(d.forbidden,a),a||c.when(a)}}}])}();